# Evaluation Utilities
This folder contains scripts used by our Evaluation framework to run and evaluate different workloads.

# Prerequisites

- CMake
- Cpp compiler
- Rust (cargo)
- perf
- cpupower

Make sure intel_pstate is disabled by providing the intel_pstat=disable Kernel parameter (Intel only), the memutil module is inserted and "memutil", "schedutil" and the "performance" governor are available.
To validate this, run `cpupower frequency-info`.

# The workloads
We provide two simple workloads ourselves: "workload-pointer-chasing" and "workload-primes".
One of them does pointer chasing on a vector.
The other one performs a simple multi-threaded prime calculation.

The pointer-chasing workload should be modified so the vector is large enough to not fit in the L1 or L2 caches.

We also heavily use the NAS benchmark suite in our evaluation, which is included in the NPB-CPP folder as a submodule.

## Setup
To set up our own "workload-pointer-chasing" and "workload-primes" executables, run the `setup.sh` script.
This will build both workloads using Cargo and CMake respectively, as well as symlink them into this directory.

To compile the NAS benchmarks, use the `setup-nas.sh` script.

# Evaluation Scripts
## `pinpoint-stats.sh`
This script is responsible for running a given workload and measuring its energy consumption, as well as clock frequency and execution time.
It also runs the workload multiple times to protect against outliers and get a sense of each runs deviation.
Output is stored as a text file in a given output directory.

## `pinpoint-frequencies.sh`
This script takes a workload, as well as a list of frequencies and runs the given workload at all given frequencies using `pinpoint-stats.sh`.
It does this by activating the "performance" governor and modifying its maximum frequency limit.

This way you can get a quick overview of which frequency is best for a given workload.

# Plotting - `plot-log.py`
This script can plot a memutil-log generated by the `copy-log.sh` script in the `kernel-module` folder.
The memutil log is typically captured during evaluation, to gain insight into why memutil has performed the way it did.

Use the `--help` option of this script for usage information.
